{"ast":null,"code":"!function (e, t) {\n  \"object\" == typeof exports && \"undefined\" != typeof module ? module.exports = t(require(\"prop-types\"), require(\"react\")) : \"function\" == typeof define && define.amd ? define([\"prop-types\", \"react\"], t) : (e = e || self).AvatarEditor = t(e.PropTypes, e.React);\n}(this, function (e, r) {\n  \"use strict\";\n\n  function a(e, t) {\n    for (var n = 0; n < t.length; n++) {\n      var o = t[n];\n      o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, o.key, o);\n    }\n  }\n\n  function s(e, t, n) {\n    return t in e ? Object.defineProperty(e, t, {\n      value: n,\n      enumerable: !0,\n      configurable: !0,\n      writable: !0\n    }) : e[t] = n, e;\n  }\n\n  function h() {\n    return (h = Object.assign || function (e) {\n      for (var t = 1; t < arguments.length; t++) {\n        var n = arguments[t];\n\n        for (var o in n) {\n          Object.prototype.hasOwnProperty.call(n, o) && (e[o] = n[o]);\n        }\n      }\n\n      return e;\n    }).apply(this, arguments);\n  }\n\n  function o(t, e) {\n    var n,\n        o = Object.keys(t);\n    return Object.getOwnPropertySymbols && (n = Object.getOwnPropertySymbols(t), e && (n = n.filter(function (e) {\n      return Object.getOwnPropertyDescriptor(t, e).enumerable;\n    })), o.push.apply(o, n)), o;\n  }\n\n  function y(t) {\n    for (var e = 1; e < arguments.length; e++) {\n      var n = null != arguments[e] ? arguments[e] : {};\n      e % 2 ? o(Object(n), !0).forEach(function (e) {\n        s(t, e, n[e]);\n      }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(t, Object.getOwnPropertyDescriptors(n)) : o(Object(n)).forEach(function (e) {\n        Object.defineProperty(t, e, Object.getOwnPropertyDescriptor(n, e));\n      });\n    }\n\n    return t;\n  }\n\n  function c(e) {\n    return (c = Object.setPrototypeOf ? Object.getPrototypeOf : function (e) {\n      return e.__proto__ || Object.getPrototypeOf(e);\n    })(e);\n  }\n\n  function u(e, t) {\n    return (u = Object.setPrototypeOf || function (e, t) {\n      return e.__proto__ = t, e;\n    })(e, t);\n  }\n\n  function l(e, t) {\n    if (null == e) return {};\n\n    var n,\n        o = function (e, t) {\n      if (null == e) return {};\n\n      for (var n, o = {}, i = Object.keys(e), a = 0; a < i.length; a++) {\n        n = i[a], 0 <= t.indexOf(n) || (o[n] = e[n]);\n      }\n\n      return o;\n    }(e, t);\n\n    if (Object.getOwnPropertySymbols) for (var i = Object.getOwnPropertySymbols(e), a = 0; a < i.length; a++) {\n      n = i[a], 0 <= t.indexOf(n) || Object.prototype.propertyIsEnumerable.call(e, n) && (o[n] = e[n]);\n    }\n    return o;\n  }\n\n  function d(e) {\n    if (void 0 === e) throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n    return e;\n  }\n\n  function p(a) {\n    var r = function () {\n      if (\"undefined\" == typeof Reflect || !Reflect.construct) return !1;\n      if (Reflect.construct.sham) return !1;\n      if (\"function\" == typeof Proxy) return !0;\n\n      try {\n        return Date.prototype.toString.call(Reflect.construct(Date, [], function () {})), !0;\n      } catch (e) {\n        return !1;\n      }\n    }();\n\n    return function () {\n      var e,\n          t,\n          n,\n          o,\n          i = c(a);\n      return t = r ? (e = c(this).constructor, Reflect.construct(i, arguments, e)) : i.apply(this, arguments), n = this, !(o = t) || \"object\" != typeof o && \"function\" != typeof o ? d(n) : o;\n    };\n  }\n\n  function f(e, t) {\n    return function (e) {\n      if (Array.isArray(e)) return e;\n    }(e) || function (e, t) {\n      if (\"undefined\" == typeof Symbol || !(Symbol.iterator in Object(e))) return;\n      var n = [],\n          o = !0,\n          i = !1,\n          a = void 0;\n\n      try {\n        for (var r, s = e[Symbol.iterator](); !(o = (r = s.next()).done) && (n.push(r.value), !t || n.length !== t); o = !0) {\n          ;\n        }\n      } catch (e) {\n        i = !0, a = e;\n      } finally {\n        try {\n          o || null == s.return || s.return();\n        } finally {\n          if (i) throw a;\n        }\n      }\n\n      return n;\n    }(e, t) || n(e, t) || function () {\n      throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n    }();\n  }\n\n  function n(e, t) {\n    if (e) {\n      if (\"string\" == typeof e) return i(e, t);\n      var n = Object.prototype.toString.call(e).slice(8, -1);\n      return \"Object\" === n && e.constructor && (n = e.constructor.name), \"Map\" === n || \"Set\" === n ? Array.from(e) : \"Arguments\" === n || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n) ? i(e, t) : void 0;\n    }\n  }\n\n  function i(e, t) {\n    (null == t || t > e.length) && (t = e.length);\n\n    for (var n = 0, o = new Array(t); n < t; n++) {\n      o[n] = e[n];\n    }\n\n    return o;\n  }\n\n  function g(i, a) {\n    return new Promise(function (e, t) {\n      var n,\n          o = new Image();\n      o.onload = function () {\n        return e(o);\n      }, o.onerror = t, !1 == (null !== (n = i) && !!n.match(/^\\s*data:([a-z]+\\/[a-z]+(;[a-z-]+=[a-z-]+)?)?(;base64)?,[a-z0-9!$&',()*+;=\\-._~:@/?%\\s]*\\s*$/i)) && a && (o.crossOrigin = a), o.src = i;\n    });\n  }\n\n  e = e && Object.prototype.hasOwnProperty.call(e, \"default\") ? e.default : e, r = r && Object.prototype.hasOwnProperty.call(r, \"default\") ? r.default : r;\n\n  function m(e) {\n    var o = !1;\n    return {\n      promise: new Promise(function (t, n) {\n        e.then(function (e) {\n          return o ? n({\n            isCanceled: !0\n          }) : t(e);\n        }, function (e) {\n          return n(o ? {\n            isCanceled: !0\n          } : e);\n        });\n      }),\n      cancel: function cancel() {\n        o = !0;\n      }\n    };\n  }\n\n  var t,\n      v = !(\"undefined\" == typeof window || \"undefined\" == typeof navigator || !(\"ontouchstart\" in window || 0 < navigator.msMaxTouchPoints)),\n      w = \"undefined\" != typeof File,\n      b = {\n    touch: {\n      react: {\n        down: \"onTouchStart\",\n        mouseDown: \"onMouseDown\",\n        drag: \"onTouchMove\",\n        move: \"onTouchMove\",\n        mouseMove: \"onMouseMove\",\n        up: \"onTouchEnd\",\n        mouseUp: \"onMouseUp\"\n      },\n      native: {\n        down: \"touchstart\",\n        mouseDown: \"mousedown\",\n        drag: \"touchmove\",\n        move: \"touchmove\",\n        mouseMove: \"mousemove\",\n        up: \"touchend\",\n        mouseUp: \"mouseup\"\n      }\n    },\n    desktop: {\n      react: {\n        down: \"onMouseDown\",\n        drag: \"onDragOver\",\n        move: \"onMouseMove\",\n        up: \"onMouseUp\"\n      },\n      native: {\n        down: \"mousedown\",\n        drag: \"dragStart\",\n        move: \"mousemove\",\n        up: \"mouseup\"\n      }\n    }\n  },\n      M = v ? b.touch : b.desktop,\n      O = \"undefined\" != typeof window && window.devicePixelRatio ? window.devicePixelRatio : 1,\n      P = {\n    x: .5,\n    y: .5\n  },\n      I = function () {\n    !function (e, t) {\n      if (\"function\" != typeof t && null !== t) throw new TypeError(\"Super expression must either be null or a function\");\n      e.prototype = Object.create(t && t.prototype, {\n        constructor: {\n          value: e,\n          writable: !0,\n          configurable: !0\n        }\n      }), t && u(e, t);\n    }(i, r.Component);\n    var e,\n        t,\n        n,\n        o = p(i);\n\n    function i(e) {\n      var v;\n      return function (e, t) {\n        if (!(e instanceof t)) throw new TypeError(\"Cannot call a class as a function\");\n      }(this, i), s(d(v = o.call(this, e)), \"state\", {\n        drag: !1,\n        my: null,\n        mx: null,\n        image: P\n      }), s(d(v), \"handleImageReady\", function (e) {\n        var t = v.getInitialSize(e.width, e.height);\n        t.resource = e, t.x = .5, t.y = .5, v.setState({\n          drag: !1,\n          image: t\n        }, v.props.onImageReady), v.props.onLoadSuccess(t);\n      }), s(d(v), \"clearImage\", function () {\n        v.canvas.getContext(\"2d\").clearRect(0, 0, v.canvas.width, v.canvas.height), v.setState({\n          image: P\n        });\n      }), s(d(v), \"handleMouseDown\", function (e) {\n        (e = e || window.event).preventDefault(), v.setState({\n          drag: !0,\n          mx: null,\n          my: null\n        });\n      }), s(d(v), \"handleMouseUp\", function () {\n        v.state.drag && (v.setState({\n          drag: !1\n        }), v.props.onMouseUp());\n      }), s(d(v), \"handleMouseMove\", function (e) {\n        var t, n, o, i, a, r, s, h, c, u, l, d, p, g, m, f;\n        e = e || window.event, !1 !== v.state.drag && (e.preventDefault(), o = {\n          mx: t = e.targetTouches ? e.targetTouches[0].pageX : e.clientX,\n          my: n = e.targetTouches ? e.targetTouches[0].pageY : e.clientY\n        }, f = v.props.rotate, f = (f %= 360) < 0 ? f + 360 : f, v.state.mx && v.state.my && (i = v.state.mx - t, a = v.state.my - n, r = v.state.image.width * v.props.scale, s = v.state.image.height * v.props.scale, c = (h = v.getCroppingRect()).x, u = h.y, c *= r, u *= s, l = function l(e) {\n          return e * (Math.PI / 180);\n        }, d = Math.cos(l(f)), g = u + -i * (p = Math.sin(l(f))) + a * d, m = {\n          x: (c + i * d + a * p) / r + 1 / v.props.scale * v.getXScale() / 2,\n          y: g / s + 1 / v.props.scale * v.getYScale() / 2\n        }, v.props.onPositionChange(m), o.image = y(y({}, v.state.image), m)), v.setState(o), v.props.onMouseMove(e));\n      }), s(d(v), \"setCanvas\", function (e) {\n        v.canvas = e;\n      }), v.canvas = null, v;\n    }\n\n    return e = i, (t = [{\n      key: \"componentDidMount\",\n      value: function value() {\n        this.props.disableHiDPIScaling && (O = 1);\n        var e,\n            t,\n            n = this.canvas.getContext(\"2d\");\n        this.props.image && this.loadImage(this.props.image), this.paint(n), document && (e = !!function () {\n          var t = !1;\n\n          try {\n            var e = Object.defineProperty({}, \"passive\", {\n              get: function get() {\n                t = !0;\n              }\n            });\n            window.addEventListener(\"test\", e, e), window.removeEventListener(\"test\", e, e);\n          } catch (e) {\n            t = !1;\n          }\n\n          return t;\n        }() && {\n          passive: !1\n        }, t = M.native, document.addEventListener(t.move, this.handleMouseMove, e), document.addEventListener(t.up, this.handleMouseUp, e), v && (document.addEventListener(t.mouseMove, this.handleMouseMove, e), document.addEventListener(t.mouseUp, this.handleMouseUp, e)));\n      }\n    }, {\n      key: \"componentDidUpdate\",\n      value: function value(e, t) {\n        this.props.image && this.props.image !== e.image || this.props.width !== e.width || this.props.height !== e.height ? this.loadImage(this.props.image) : this.props.image || t.image === P || this.clearImage();\n        var n = this.canvas.getContext(\"2d\");\n        n.clearRect(0, 0, this.canvas.width, this.canvas.height), this.paint(n), this.paintImage(n, this.state.image, this.props.border), e.image === this.props.image && e.width === this.props.width && e.height === this.props.height && e.position === this.props.position && e.scale === this.props.scale && e.rotate === this.props.rotate && t.my === this.state.my && t.mx === this.state.mx && t.image.x === this.state.image.x && t.image.y === this.state.image.y || this.props.onImageChange();\n      }\n    }, {\n      key: \"componentWillUnmount\",\n      value: function value() {\n        var e;\n        document && (e = M.native, document.removeEventListener(e.move, this.handleMouseMove, !1), document.removeEventListener(e.up, this.handleMouseUp, !1), v && (document.removeEventListener(e.mouseMove, this.handleMouseMove, !1), document.removeEventListener(e.mouseUp, this.handleMouseUp, !1)));\n      }\n    }, {\n      key: \"isVertical\",\n      value: function value() {\n        return !this.props.disableCanvasRotation && this.props.rotate % 180 != 0;\n      }\n    }, {\n      key: \"getBorders\",\n      value: function value(e) {\n        var t = 0 < arguments.length && void 0 !== e ? e : this.props.border;\n        return Array.isArray(t) ? t : [t, t];\n      }\n    }, {\n      key: \"getDimensions\",\n      value: function value() {\n        var e = this.props,\n            t = e.width,\n            n = e.height,\n            o = e.rotate,\n            i = e.border,\n            a = {},\n            r = f(this.getBorders(i), 2),\n            s = r[0],\n            h = r[1],\n            c = t,\n            u = n;\n        return this.isVertical() ? (a.width = u, a.height = c) : (a.width = c, a.height = u), a.width += 2 * s, a.height += 2 * h, {\n          canvas: a,\n          rotate: o,\n          width: t,\n          height: n,\n          border: i\n        };\n      }\n    }, {\n      key: \"getImage\",\n      value: function value() {\n        var e = this.getCroppingRect(),\n            t = this.state.image;\n        e.x *= t.resource.width, e.y *= t.resource.height, e.width *= t.resource.width, e.height *= t.resource.height;\n        var n = document.createElement(\"canvas\");\n        this.isVertical() ? (n.width = e.height, n.height = e.width) : (n.width = e.width, n.height = e.height);\n        var o = n.getContext(\"2d\");\n        return o.translate(n.width / 2, n.height / 2), o.rotate(this.props.rotate * Math.PI / 180), o.translate(-n.width / 2, -n.height / 2), this.isVertical() && o.translate((n.width - n.height) / 2, (n.height - n.width) / 2), o.drawImage(t.resource, -e.x, -e.y), n;\n      }\n    }, {\n      key: \"getImageScaledToCanvas\",\n      value: function value() {\n        var e = this.getDimensions(),\n            t = e.width,\n            n = e.height,\n            o = document.createElement(\"canvas\");\n        return this.isVertical() ? (o.width = n, o.height = t) : (o.width = t, o.height = n), this.paintImage(o.getContext(\"2d\"), this.state.image, 0, 1), o;\n      }\n    }, {\n      key: \"getXScale\",\n      value: function value() {\n        var e = this.props.width / this.props.height,\n            t = this.state.image.width / this.state.image.height;\n        return Math.min(1, e / t);\n      }\n    }, {\n      key: \"getYScale\",\n      value: function value() {\n        var e = this.props.height / this.props.width,\n            t = this.state.image.height / this.state.image.width;\n        return Math.min(1, e / t);\n      }\n    }, {\n      key: \"getCroppingRect\",\n      value: function value() {\n        var e = this.props.position || {\n          x: this.state.image.x,\n          y: this.state.image.y\n        },\n            t = 1 / this.props.scale * this.getXScale(),\n            n = 1 / this.props.scale * this.getYScale(),\n            o = {\n          x: e.x - t / 2,\n          y: e.y - n / 2,\n          width: t,\n          height: n\n        },\n            i = 0,\n            a = 1 - o.width,\n            r = 0,\n            s = 1 - o.height;\n        return (this.props.disableBoundaryChecks || 1 < t || 1 < n) && (i = -o.width, r = -o.height, s = a = 1), y(y({}, o), {}, {\n          x: Math.max(i, Math.min(o.x, a)),\n          y: Math.max(r, Math.min(o.y, s))\n        });\n      }\n    }, {\n      key: \"loadImage\",\n      value: function value(e) {\n        var t;\n        w && e instanceof File ? this.loadingImage = m((t = e, new Promise(function (n, o) {\n          var e = new FileReader();\n          e.onload = function (e) {\n            try {\n              var t = g(e.target.result);\n              n(t);\n            } catch (e) {\n              o(e);\n            }\n          }, e.readAsDataURL(t);\n        }))).promise.then(this.handleImageReady).catch(this.props.onLoadFailure) : \"string\" == typeof e && (this.loadingImage = m(g(e, this.props.crossOrigin)).promise.then(this.handleImageReady).catch(this.props.onLoadFailure));\n      }\n    }, {\n      key: \"getInitialSize\",\n      value: function value(e, t) {\n        var n,\n            o,\n            i = this.getDimensions();\n        return t / e < i.height / i.width ? o = e * ((n = this.getDimensions().height) / t) : n = t * ((o = this.getDimensions().width) / e), {\n          height: n,\n          width: o\n        };\n      }\n    }, {\n      key: \"paintImage\",\n      value: function value(e, t, n, o) {\n        var i,\n            a = 3 < arguments.length && void 0 !== o ? o : O;\n        t.resource && (i = this.calculatePosition(t, n), e.save(), e.translate(e.canvas.width / 2, e.canvas.height / 2), e.rotate(this.props.rotate * Math.PI / 180), e.translate(-e.canvas.width / 2, -e.canvas.height / 2), this.isVertical() && e.translate((e.canvas.width - e.canvas.height) / 2, (e.canvas.height - e.canvas.width) / 2), e.scale(a, a), e.globalCompositeOperation = \"destination-over\", e.drawImage(t.resource, i.x, i.y, i.width, i.height), e.restore());\n      }\n    }, {\n      key: \"calculatePosition\",\n      value: function value(e, t) {\n        e = e || this.state.image;\n        var n = f(this.getBorders(t), 2),\n            o = n[0],\n            i = n[1],\n            a = this.getCroppingRect(),\n            r = e.width * this.props.scale,\n            s = e.height * this.props.scale,\n            h = -a.x * r,\n            c = -a.y * s;\n        return this.isVertical() ? (h += i, c += o) : (h += o, c += i), {\n          x: h,\n          y: c,\n          height: s,\n          width: r\n        };\n      }\n    }, {\n      key: \"paint\",\n      value: function value(e) {\n        e.save(), e.scale(O, O), e.translate(0, 0), e.fillStyle = \"rgba(\" + this.props.color.slice(0, 4).join(\",\") + \")\";\n        var t,\n            n,\n            o,\n            i,\n            a,\n            r,\n            s,\n            h,\n            c = this.props.borderRadius,\n            u = this.getDimensions(),\n            l = f(this.getBorders(u.border), 2),\n            d = l[0],\n            p = l[1],\n            g = u.canvas.height,\n            m = u.canvas.width,\n            c = Math.max(c, 0);\n        c = Math.min(c, m / 2 - d, g / 2 - p), e.beginPath(), t = e, i = m - 2 * (n = d), a = g - 2 * (o = p), 0 === (r = c) ? t.rect(n, o, i, a) : (s = i - r, h = a - r, t.translate(n, o), t.arc(r, r, r, Math.PI, 1.5 * Math.PI), t.lineTo(s, 0), t.arc(s, r, r, 1.5 * Math.PI, 2 * Math.PI), t.lineTo(i, h), t.arc(s, h, r, 2 * Math.PI, .5 * Math.PI), t.lineTo(r, a), t.arc(r, h, r, .5 * Math.PI, Math.PI), t.translate(-n, -o)), e.rect(m, 0, -m, g), e.fill(\"evenodd\"), e.restore();\n      }\n    }, {\n      key: \"render\",\n      value: function value() {\n        var e = this.props,\n            t = (e.scale, e.rotate, e.image, e.border, e.borderRadius, e.width, e.height, e.position, e.color, e.style),\n            n = (e.crossOrigin, e.onLoadFailure, e.onLoadSuccess, e.onImageReady, e.onImageChange, e.onMouseUp, e.onMouseMove, e.onPositionChange, e.disableBoundaryChecks, e.disableHiDPIScaling, e.disableCanvasRotation, l(e, [\"scale\", \"rotate\", \"image\", \"border\", \"borderRadius\", \"width\", \"height\", \"position\", \"color\", \"style\", \"crossOrigin\", \"onLoadFailure\", \"onLoadSuccess\", \"onImageReady\", \"onImageChange\", \"onMouseUp\", \"onMouseMove\", \"onPositionChange\", \"disableBoundaryChecks\", \"disableHiDPIScaling\", \"disableCanvasRotation\"])),\n            o = this.getDimensions(),\n            i = {\n          width: o.canvas.width,\n          height: o.canvas.height,\n          cursor: this.state.drag ? \"grabbing\" : \"grab\",\n          touchAction: \"none\"\n        },\n            a = {\n          width: o.canvas.width * O,\n          height: o.canvas.height * O,\n          style: y(y({}, i), t)\n        };\n        return a[M.react.down] = this.handleMouseDown, v && (a[M.react.mouseDown] = this.handleMouseDown), r.createElement(\"canvas\", h({\n          ref: this.setCanvas\n        }, a, n));\n      }\n    }]) && a(e.prototype, t), n && a(e, n), i;\n  }();\n\n  return s(I, \"propTypes\", {\n    scale: e.number,\n    rotate: e.number,\n    image: e.oneOfType([e.string].concat(function (e) {\n      if (Array.isArray(e)) return i(e);\n    }(t = w ? [e.instanceOf(File)] : []) || function (e) {\n      if (\"undefined\" != typeof Symbol && Symbol.iterator in Object(e)) return Array.from(e);\n    }(t) || n(t) || function () {\n      throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n    }())),\n    border: e.oneOfType([e.number, e.arrayOf(e.number)]),\n    borderRadius: e.number,\n    width: e.number,\n    height: e.number,\n    position: e.shape({\n      x: e.number,\n      y: e.number\n    }),\n    color: e.arrayOf(e.number),\n    crossOrigin: e.oneOf([\"\", \"anonymous\", \"use-credentials\"]),\n    onLoadFailure: e.func,\n    onLoadSuccess: e.func,\n    onImageReady: e.func,\n    onImageChange: e.func,\n    onMouseUp: e.func,\n    onMouseMove: e.func,\n    onPositionChange: e.func,\n    disableBoundaryChecks: e.bool,\n    disableHiDPIScaling: e.bool,\n    disableCanvasRotation: e.bool\n  }), s(I, \"defaultProps\", {\n    scale: 1,\n    rotate: 0,\n    border: 25,\n    borderRadius: 0,\n    width: 200,\n    height: 200,\n    color: [0, 0, 0, .5],\n    onLoadFailure: function onLoadFailure() {},\n    onLoadSuccess: function onLoadSuccess() {},\n    onImageReady: function onImageReady() {},\n    onImageChange: function onImageChange() {},\n    onMouseUp: function onMouseUp() {},\n    onMouseMove: function onMouseMove() {},\n    onPositionChange: function onPositionChange() {},\n    disableBoundaryChecks: !1,\n    disableHiDPIScaling: !1,\n    disableCanvasRotation: !0\n  }), I;\n});","map":null,"metadata":{},"sourceType":"script"}